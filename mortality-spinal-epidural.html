<!DOCTYPE html>
<html>

<head>
    <title></title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
</head>
<style type="text/css">
    .settingsEdge {
        border-radius: 15px;
        -webkit-border-radius: 15px;
        -moz-border-radius: 15px;
        border: 3px solid #E0DDD7;
/*        width: 100px;
*/        height: 75px;
    }
    
    .settingsEdgeLegand {
        text-align: center;
        font-size: 16px;
        font-weight: bold;
    }

.section_header{
  text-align: center;
  font-size: 20px;
  margin-top: 10px;
  margin-bottom: 10px;
}
body {
    background-image: url("assets/img/background.png");
    background-repeat: repeat;
}


</style>

<body>
    <div class="container">
        <div class="row" style="height: 50px;"></div>
        <div class="row" style="border-bottom:  3px solid #222222;padding-bottom: 20px;">
        <div class="col-md-6">
            <div class="row section_header" >
              <div class="col align-self-center">
            Demographic</div>
          </div>
            <div class="row" style="border:3px solid #E0DDD7;padding: 20px;">
                
                <div class="col-sm-4 " >
                    <div class="settingsEdge" >
                    <div class="settingsEdgeLegand"  style="width: 80px; ">Gender</div>
                    <input type="radio" name="gender" value="0" class="gender" checked> Male
                    <br>
                    <input type="radio" name="gender" class="gender" value="1"> Female
                    <br>
                   </div> 
                </div>
                <div class="col-sm-3  offset-sm-1 ">
                    <div class="settingsEdge">
                        <div class="settingsEdgeLegand"  style="width: 80px; ">Age</div>
                            <input id="age" type="number" value="20" min="18" max="100" placeholder="20" style="width: 95%;position: relative; left: 2%">
                        </div>

                </div>
                <div class="col-sm-3  offset-sm-1 " style="height: 100%;">
                    <div class="settingsEdge">
                  <div class="settingsEdgeLegand"  style="width: 80px; ">Race</div>
                        <select class="Race" style="width: 95%;position: relative; left: 2%">
                            <option value="0">white</option>
                            <option value="1">black</option>
                            <option value="2">Hispanic</option>
                            <option value="3">other</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row section_header" >
              <div class="col align-self-center">
            Hospital</div>
          </div>

            <div class="row" style="border:3px solid #E0DDD7;padding: 20px;">
                <div class="col-sm-3"  >
                <div  class="settingsEdge">
                    <div class="settingsEdgeLegand" >Insurance</div>
                    <select class="PAY1" style="width: 95%;position: relative; left: 2%">
                      <option   value="0">Medicare</option>
                      <option  value="1">Medicaid</option>
                      <option  value="2">Private insurance</option>
                      <option  value="3">Other</option>
                    </select>                

                    </div>
                </div>
               <div class="col-sm-4 ">
                <div class="  settingsEdge" >
                <div class="settingsEdgeLegand" >Hospital size</div>
                  <select class="HOSP_BEDSIZE" style="width: 95%;position: relative; left: 2%">
                    <option   value="0">small</option>
                    <option  value="1">medium</option>
                    <option  value="2">large</option>
                  </select>
                </div>
                </div> 
                <div class="col-sm-5 ">
                <div class=" settingsEdge" >
                <div class="settingsEdgeLegand" >Teaching Hospital</div>
                  <select class="Hosp_locteach" style="width: 95%;position: relative; left: 2%">
                    <option   value="0">rural</option>
                    <option  value="1">urban non-teaching</option>
                    <option  value="2">urban teaching</option>
                  </select>
                </div>
                </div>              
            </div>



            </div>

            <div class="col-md-6" >
                <div class=" settingsEdge" style=" padding-left: 15px; background-color:#ffffff ; border-width:  5px  ;height: 330px;margin-top: 10px;">
                <div class="row " style="height: 35px;border-bottom:  1px solid #222222; padding-bottom: 5px;margin: 5px;  width: 90%;position: relative;left: 5%; "  >

                   <span style="font-size: 16px;font-weight: bold; margin-right: 2%; margin-bottom: 10px;"> ICD9 Code : </span>
                <input type="text" id="add_variable" name="add" autocomplete="off" style="width: 50%;">
                <button id="add">Add</button>
                
                </div>
                <div class="row"  style="height: 280px; width: 90%; overflow-y: auto;overflow-x: hidden;">
                    <ul id="v_list" class="list-group" style="width: 90%; margin-left: 10%;" ></ul>
                </div>

            </div>
            </div>
        </div>
    <div class="row" style="margin-top: 20px;" >
        <div  style="position: relative;left: 30%; ">

        <div class="btn btn-success" id="predict_btn" style="height: 45px;width: 150px;float: left;margin-top: 5px;padding-top: 10px;font-size: 18px;">Predict</div>
        <div  id="results" style="float: left;font-size: 40px;font-weight: bold;"></div>
    </div>
    </div>
    </div>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="assets/js/ICD9.js"></script>
    <script type="text/javascript">
        var x = {
            "AGE_bin": 1,
            "FEMALE": 0,
            'Race': 0,
            'PAY1': 0,
            'HOSP_BEDSIZE': 0,
            'Hosp_locteach': 0,
            "other_variables": []

        };

        $('.gender').click(function() {
            var gender = $("input[name='gender']:checked").val();
            x['FEMALE'] = gender;
        });

        $("#age").change(function() {
            var age = $(this).val();
            if (age >= 80) {
                x["AGE_bin"] = 6;
                return
            }
            if (age >= 70) {
                x["AGE_bin"] = 5;
                return
            }
            if (age >= 60) {
                x["AGE_bin"] = 4;
                return
            }
            if (age >= 50) {
                x["AGE_bin"] = 3;
                return
            }
            if (age >= 40) {
                x["AGE_bin"] = 2;
                return
            }
            if (age >= 30) {
                x["AGE_bin"] = 1;
                return
            }
            if (age >= 18) {
                x["AGE_bin"] = 0;
                return
            }
        });

        $('.Race').click(function() {
            var Race = $(this).val();
            x['Race'] = Race;
        });
        $('.PAY1').click(function() {
            var PAY1 = $(this).val();
            x['PAY1'] = PAY1;
        });

        $('.HOSP_BEDSIZE').click(function() {
            var HOSP_BEDSIZE = $(this).val();
            x['HOSP_BEDSIZE'] = HOSP_BEDSIZE;
        });
        $('.Hosp_locteach').click(function() {
            var HOSP_BEDSIZE = $(this).val();
            x['HOSP_BEDSIZE'] = HOSP_BEDSIZE;
        });

        $('#add').click(function() {
            var variable = $("#add_variable").val().trim();
            var variable_trim;
            if (variable.length == 3) {
                variable_trim = variable;
            } else {
                var match = /(\d|[a-z]|[A-z])(\d|[a-z]|[A-z])(\d|[a-z]|[A-z])\.(\d|[a-z]|[A-z])*/.exec(variable)

                if (match) {
                    match = match[0].toString()

                    if (match.length == variable.length) {
                        variable_trim = variable.replace(/\./g, '');
                        variable_trim = variable_trim.trim();

                    } else {
                        alert(variable + ' is not valid!');
                    }
                } else {
                    alert(variable + ' is not valid!');
                }

            }

            var douplication = 0;
            if (variable_trim) {
                for (i in x['other_variables']) {
                    if (variable_trim.toString() == x['other_variables'][i].toString()) {
                        douplication = 1;
                        break;
                    }
                }
                if (douplication == 1) {
                    alert(variable + ' is already added!')
                } else {
                    var validCode;
                    for (i in ICD9) {
                        if (variable_trim.toString() == ICD9[i].toString()) {
                            validCode = 1;
                            break;
                        }
                    }
                    if (!validCode) {
                        alert(variable + ' is not valid!');
                        return;
                    }

                    x['other_variables'].push(variable_trim);
                    var id = variable_trim;
                    var div = $('<li style="padding: 0px; margin:0px;" class="variables list-group-item" ></li>');
                    // div.css('margin', 5);
                    var lbl = $('<label id = ' + id + ' class="btn btn-info variables glyphicon glyphicon-remove"></span>&nbsp; ' + variable + " : " + ICD9Obj[variable_trim] + '</label>');
                    lbl.attr('id', id);
                    lbl.data('variable', variable_trim);
                    lbl.css('width', '100%');
                    lbl.css('height', '100%');
                    div.css('margin-bottom', 5);
                    lbl.css('text-align', 'left');
                    div.append(lbl);
                    $('#v_list').append(div);
                }
            }
        });

        $(document).on('click', '.variables', function() {
            
            var variable = $(this).data('variable');
            var index = x['other_variables'].indexOf(variable);
            if (index > -1) {
                x['other_variables'].splice(index, 1);
                $(this).remove();
            }
        });

        var url = "https://mortality-spinal-epidural.herokuapp.com/predict_probability";
        // url = "http://127.0.0.1:5000/predict_probability";
        $("#predict_btn").click(function() {
        $('*').css('cursor','wait');

            $.ajax({
                type: 'post',
                url: url,
                data: JSON.stringify(x),
                contentType: "application/json; charset=utf-8",
                traditional: true,
                success: function(data) {
                    $('*').css('cursor','default');
                    var output = data.result*100;
                    output = round(output,1);
                    $('#results').text(' '+output + '%');
                    

                },
                error: function (textStatus, errorThrown) {
                   $('*').css('cursor','default');
                   $('#results').text('error'); 
                },
            });

    
        
        });

function round(value, decimals) {
  return Number(Math.round(value+'e'+decimals)+'e-'+decimals);
}


    </script>
</body>

</html>